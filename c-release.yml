name: $(BuildID)_$(BuildDefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)

jobs:

- job: Setup
  pool:
    vmImage: windows-latest
  displayName: My Phase
  condition: succeededOrFailed()

  steps:
  - checkout: self
    persistCredentials: true

  - task: DownloadBuildArtifacts@0
    condition: succeededOrFailed()
    inputs:
      buildType: specific
      project: f9b79625-2860-4d92-a4ee-57b03fabfd10 # azure-iot-sdks
      pipeline: $(scriptspipelineid) # iot-sdks-internals-scripts pipeline
      buildVersionToDownload: latest
      downloadType: single
      downloadPath: $(System.ArtifactsDirectory)/scripts
      artifactName: c

  - task: PowerShell@2
    inputs:
      filePath: $(System.ArtifactsDirectory)/scripts/c/Update-Versions.ps1
    env:
      ReleaseOutput: $(System.ArtifactsDirectory)/bin
      ReleaseSources: $(Build.SourcesDirectory)
      ReleaseInternals: "" # TODO can't have broad reference; need specific location(s)
      PSModulesFile: $(System.ArtifactsDirectory)/scripts/c/cSDKRelease.psm1
    enabled: false

